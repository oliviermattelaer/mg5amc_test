#!- tested for: aMC_MG5_v2_2_3 -!#

This script builds masseffects in the SM, MSSM and 2HDM for the 
gluon fusion process (g g > h) at NLO QCD. The Matrixelements
are taken from SusHi (http://sushi.hepforge.org/). Compiled
versions of SusHi and FeynHiggs (http://www.feynhiggs.de/) are
needed. These codes can be either downloaded and installed
automatically by this script or set up by the user beforehand.
This script modified MG5_aMC files and links SusHi and FeyHiggs. 

The first argument sets the path (ggH-path) of the folder where the 
g g > h process is installed. The second argument can be set to the path
of the lib folder of FeynHiggs (containing the file libFH.a) and the 
third argument to the path of the lib folder of SusHi (containing the 
file libsushi.a). If either of these lib paths are not set, the script 
will ask if it should download and install the corresponding code
automatically. Note, that the script will download the latest versions
of the programs. If you disagree, you are asked to type the path of the
corresponding lib folder. If either path does not exist or you leave
them empty, you have to link the missing libraries libsushiFH.a/libFH.a
by hand to the lib folder in your ggH-folder.


INSTRUCTIONS to set up the process folder (>= MG5_aMC_v2_2_3):

1a. Simplest installation (single line solution)
NOTE: if you have FeynHiggs (or FeynHiggs and SusHi) already installed, 
      for example from a previous run of this script, you can also 
      continue with instructions 2b in order to use these installations.

If you want the script to create the process folder, download SusHi 
and FeynHiggs:

- go into source folder of the ggH modifications
> cd /path/to/MG5_aMC/MG5_aMC_v2_X_X/src_mod_ggH

- start script to add MSSM (and 2HDM) capabilities to ggH-folder
> ./set_up_ggH_MSSM_script.pl /path/to/MG5_aMC/MG5_aMC_v2_X_X/ggH-folder

and follow the instructions.

IMPORTANT: ggH-folder has to be in the MG5_aMC directory!

You will be successively asked if FeynHiggs and SusHi should be 
downloaded and installed automatically. You also have to state whether 
you want to configure with
> ./configure FC=gfortran FFLAGS=-mcmodel=large
instead of
> ./configure F77=gfortran
With some compilers the latter produces errors of the form
"relocation truncated to fit: R_X86_64_32S" when running MG5_aMC later.
While the former produces problems on some Mac OS X systems.

The script then creates the ggH-folder, modifies the appropiate files 
and links libsushiFH.a and libFH.a to ggH-folder/lib.

To confirm the result of the total cross section: when you don't change 
the cards it should be compatible with 3.235e+01 +- 2.3e-01 pb (13 TeV).
Changing only the machine energy to 8 TeV: 1.438e+01 +- 8.7e-03 pb

------------------- in the best case, this is it --------------------



In case you want to set up the proces folder by hand, follow the 
instructions under 1b. and run the script under as under 1a. afterwards.
Choose to not replace the folder but continue with the script when asked.

In case you want to set up FeynHiggs (and SusHi) by hand, follow the
instructions under 2b instead. Under 2c you can find the prescription
in case you want to link SusHi and FeynHiggs by hand.


1b. Create folder for g g > h with MG5_aMC in heft model by hand:
- go into MG5_aMC folder
> cd /path/to/MG5_aMC/MG5_aMC_v2_X_X

- start MG5_aMC by typing
> ./bin/mg5_aMC

- continue with the following steps:
MG5_aMC>import model heft-no_b_mass
MG5_aMC>define p = p b b~
MG5_aMC>generate p p > h [real=QCD]
MG5_aMC>output ggH-folder
MG5_aMC>exit

This creates a folder /path/to/MG5_aMC/MG5_aMC_v2_X_X/ggH-folder 
containing the process. Not including the virtuals by [real=QCD] does 
not matter, since the script will replace all matrixelements anyway, 
thus ignore the warning.


2b. FeynHiggs (or FeynHiggs and SusHi) already installed
Alternatvely, you can set up FeynHiggs (and SusHi) before running the script.
Please check out the hints at the bottom of this file as well as the
corresponding manuals.
If there is a compiled FeynHiggs version on your computer you can run
the script with
> ./set_up_ggH_MSSM_script.pl /path/to/MG5_aMC/MG5_aMC_v2_X_X/ggH-folder /path/to/FeynHiggs/FeynHiggs-X.X.X/<prefix>/lib(64)
The script will then automatically download SusHi.
If FeynHiggs and SusHi are already set up, the script can be called by
> ./set_up_ggH_MSSM_script.pl /path/to/MG5_aMC/MG5_aMC_v2_X_X/ggH-folder /path/to/FeynHiggs/FeynHiggs-X.X.X/<prefix>/lib(64) /path/to/SusHi/SusHi-X.X.X/lib
Note: It is advisable to use absolute paths, however, relative paths 
should work as well.


2c. execute script and link by hand
- go into source folder of the ggH modifications
> cd /path/to/MG5_aMC/MG5_aMC_v2_X_X/src_mod_ggH

- start script to add MSSM (and 2HDM) capabilities to ggH-folder
> ./set_up_ggH_MSSM_script.pl /path/to/MG5_aMC/MG5_aMC_v2_X_X/ggH-folder
> n
> ENTER
> n
> ENTER

- go into lib folder of the ggH-folder
> cd /path/to/MG5_aMC/MG5_aMC_v2_X_X/ggH-folder/lib

- link SusHi and FeynHiggs by hand
> ln -ns /path/to/SusHi/SusHi-X.X.X/lib/libsushiFH.a .
> ln -ns /path/to/FeynHiggs/FeynHiggs-X.X.X/<prefix>/lib/libFH.a .


3. compile and run MG5_aMC
> cd /path/to/MG5_aMC/MG5_aMC_v2_X_X/ggH-folder

- for fixed order
> ./bin/calculate_xsect
> ENTER

- for event generation
> ./bin/generate_events
> ENTER
> ENTER

--------------------------------------------------------------------------
--------------------------------------------------------------------------

Hints for the download and installation of FeynHiggs and SusHi:
This is only needed if you want to set up these codes by hand.

a. create FeynHiggs library:
- goto folder where you want to install FeynHiggs
> cd /path/to/FeynHiggs

- download FeynHiggs (version 2.10.0 or higher, current: 2.10.1) from 
  http://www.feynhiggs.de/ or type
> curl -O http://wwwth.mpp.mpg.de/members/heinemey/feynhiggs/newversion/FeynHiggs-X.X.X.tar.gz
> tar -xf FeynHiggs-X.X.X.tar.gz
> cd FeynHiggs-X.X.X

- compile FeynHiggs
> ./configure FC=gfortran
> make
> make install

[optional:
you might want to configure with
> ./configure FC=gfortran FFLAGS=-mcmodel=large
instead, otherwise you might (depends on compiler version) get 
errors of the form "relocation truncated to fit: R_X86_64_32S" 
when running MG5_aMC later.
]

libFH.a will be in /path/to/FeynHiggs/FeynHiggs-X.X.X/<prefix>/lib 
(or lib64), where <prefix> is by default the same as the HOSTTYPE 
environment variable (e.g. x86_64-Darwin or x86_64-linux)


b. create SusHi library:
- goto folder where you want to install SusHi
> cd /path/to/SusHi

- download SusHi (version 1.3.0 or higher) from 
  http://sushi.hepforge.org, or type 
> curl -O https://www.hepforge.org/archive/sushi/SusHi-X.X.X.tar.gz
> tar -xf SusHi-X.X.X.tar.gz
> cd SusHi-X.X.X

- set path for FeynHiggs in Makefile (this is not necessary, if you 
  ignore the error after "make" the library should still be there) 
  and type
> ./configure F77=gfortran
> make predef=FH

[optional:
you might want to configure with
> ./configure F77=gfortran F77LAGS=-mcmodel=large
instead, otherwise you might (depends on compiler version) get 
errors of the form "relocation truncated to fit: R_X86_64_32S" 
when running MG5_aMC later.
]

libsushiFH.a will be in /path/to/SusHi/SusHi-X.X.X/lib
