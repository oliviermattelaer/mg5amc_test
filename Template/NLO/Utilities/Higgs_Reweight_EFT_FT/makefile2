include ../proc_characteristics
include ../../Source/make_opts
include ../analyse_opts

LIBDIR = ../../lib/
MADLOOPLIBDIR = ../ML5lib_reweight/lib/
ANADIR = ../../FixedOrderAnalysis/

#check if fastjet-config is set
ifdef fastjet_config
    FASTJET_CONFIG = $(fastjet_config)
    CXXFLAGS += $(shell $(FASTJET_CONFIG) --cxxflags)
    FJLIBS += $(shell $(FASTJET_CONFIG) --libs --plugins ) -lstdc++
    fastjetfortran_madfks=fastjetfortran_madfks_full.o fastjet_wrapper.o
else
    fastjetfortran_madfks=fastjetfortran_madfks_core.o fjcore.o fastjet_wrapper.o
    FJLIBS += -lstdc++
endif


NLOLIBS=-L$(MADLOOPLIBDIR) -lMadLoop $(libcuttools) $(libOLP) -ldhelas -lmodel
LINKLIBS = -L$(LIBDIR) -lgeneric -lpdf -lcernlib $(lhapdf)
LIBS =  $(MADLOOPLIBDIR)libdhelas.a $(LIBDIR)libgeneric.a $(MADLOOPLIBDIR)libmodel.a \
$(LIBDIR)libpdf.a $(LIBDIR)libcernlib.a $(MADLOOPLIBDIR)$(libmadloop)


# Files for event reweighting to get e.g. scale and PDF uncertainties
RWGFILES=reweight_xsec_events_loop2.o handling_lhe_events.o reweight_xsec.o	\
	$(patsubst %.f,%.o,$(wildcard parton_lum_*.f)) setscales.o	\
         boostwdir2.o 			\
	$(reweight_xsec_events_pdf_dummy) fill_MC_mshell.o cluster.o	\
	reweight.o get_color.o iproc_map.o fks_inc_chooser.o 		\
	leshouche_inc_chooser.o loop_matrix_lib.o

%.o: %.f
	$(FC) $(FFLAGS) -c -I. $<
%.o: $(ANADIR)/%.f
	$(FC) $(FFLAGS) -c -I. -I$(ANADIR) $(FO_INCLUDEPATHS) $<
%.o: %.for
	$(FC) $(FFLAGS) -c -I. -I$(ANADIR) $<
%.o: $(ANADIR)/%.for
	$(FC) $(FFLAGS) -c -I. -I$(ANADIR) $(FO_INCLUDEPATHS) $<
%.o: %.c
	$(CXX) $(CFLAGS) -c -I. $^
%.o: $(ANADIR)/%.c
	$(CXX) $(CFLAGS) -c -I. -I$(ANADIR) $(FO_INCLUDEPATHS) $^
%.o: %.cc
	$(CXX) $(CXXFLAGS) -c -I. $^
%.o: $(ANADIR)/%.cc
	$(CXX) $(CXXFLAGS) -c -I. -I$(ANADIR) $(FO_INCLUDEPATHS) $^


reweight_loop_events: $(RWGFILES) makefile $(LIBS)
	$(FC) $(LDFLAGS) -o reweight_xsec_events $(RWGFILES) $(NLOLIBS) $(LINKLIBS) $(FJLIBS)
	strip reweight_xsec_events

clean:
	@rm -f *.o write_ajob_basic reweight_xsec_events madevent_* check_poles\
	    test_M* gensym
	for dir in `ls -d V*`; do cd $$dir; make clean; cd ../; done

