# Environment variables

ifeq ($(origin FFLAGS),undefined)
  FFLAGS= -O -w -fbounds-check -fPIC
  #FFLAGS+= -g -fbounds-check -ffpe-trap=invalid,zero,overflow,underflow,denormal -Wall
endif

ifeq ($(origin CXXFLAGS),undefined)
  #CXXFLAGS= -g 
  CXXFLAGS = -O 
endif

ifeq ($(origin CFLAGS),undefined)
  #CFLAGS= -g 
  CFLAGS = -O 
endif

# Increase the number of allowed charcters in a Fortran line
FFLAGS+= -ffixed-line-length-132

# Set FC unless it's defined by an environment variable
ifeq ($(origin FC),default)
   FC=gfortran
endif
ifeq ($(origin F2PY), undefined)
   F2PY=f2py
endif

# Set CXX unless it's defined by an environment variable
ifeq ($(origin CXX),default)
  CXX=g++
endif

# Options: dynamic, lhapdf

UNAME := $(shell uname)

# Option dynamic

ifeq ($(UNAME), Darwin)
  dylibext=dylib
else
  dylibext=so  
endif

ifdef dynamic
  ifeq ($(UNAME), Darwin)
    libext=dylib
    FFLAGS+= -fno-common
    LDFLAGS += -bundle
    define CREATELIB
      $(FC) -dynamiclib -undefined dynamic_lookup -o $(1) $(2)
    endef
  else
    libext=so
    FFLAGS+= -fPIC
    LDFLAGS += -shared
    define CREATELIB
      $(FC) $(FFLAGS) $(LDFLAGS) -o $(1) $(2)
    endef
  endif
else
  libext=a
  define CREATELIB
    $(AR) cru $(1) $(2)
    ranlib $(1)
  endef
endif

# Option lhapdf

ifdef lhapdf
  CXXFLAGS += $(shell $(lhapdf) --cppflags)
  alfas_functions=alfas_functions_lhapdf
  llhapdf=-lLHAPDF -lstdc++
else
  alfas_functions=alfas_functions
  llhapdf=
endif
